<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AapdaSetu | Disaster Response</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* CUSTOM STYLES FOR LANDING */
        body { background-color: #f8f9fa; font-family: 'Segoe UI', sans-serif; }
        
        /* The Split Screen Landing */
        #landing-view {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .role-card {
            transition: transform 0.3s;
            cursor: pointer;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .role-card:hover { transform: translateY(-10px); }
        
        /* Admin Dashboard Styles */
        #admin-dashboard { display: none; } /* Hidden by default */
        .map-container { height: 500px; width: 100%; border-radius: 10px; }
        .status-pending { border-left: 5px solid #ffc107; }
        .status-active { border-left: 5px solid #dc3545; }
    </style>
</head>
<body>

    <div id="landing-view" class="container-fluid">
        <div class="row w-100 justify-content-center gap-4">
            
            <div class="col-12 text-center text-white mb-5">
                <h1 class="display-4 fw-bold">AAPDASETU</h1>
                <p class="lead">Select your role to access the disaster management portal.</p>
            </div>

            <div class="col-md-4">
                <div class="card role-card p-4 text-center" onclick="selectRole('citizen')">
                    <div class="card-body">
                        <h2 class="text-success mb-3">Citizen</h2>
                        <p class="text-muted">Receive alerts, report incidents, and access safety guides.</p>
                        <button class="btn btn-outline-success w-100">Enter Portal</button>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card role-card p-4 text-center" onclick="selectRole('admin')">
                    <div class="card-body">
                        <h2 class="text-primary mb-3">Authority</h2>
                        <p class="text-muted">Manage resources, verify alerts, and coordinate response.</p>
                        <button class="btn btn-outline-primary w-100">Admin Login</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="modal fade" id="authModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Verification Required</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="authForm">
                        <div id="admin-inputs" class="d-none">
                            <div class="mb-3">
                                <label>Government ID (Email)</label>
                                <input type="email" class="form-control" id="adminEmail" placeholder="admin@ndma.gov.in">
                            </div>
                            <div class="mb-3">
                                <label>Secure Password</label>
                                <input type="password" class="form-control" id="adminPass">
                            </div>
                        </div>

                        <div id="citizen-inputs" class="d-none text-center">
                            <p>To provide hyperlocal alerts, we need your location.</p>
                            <button type="button" class="btn btn-warning w-100" onclick="getGeoLocation()">
                                <i class="bi bi-geo-alt"></i> Auto-Fetch Location
                            </button>
                            <p id="location-status" class="mt-2 small text-muted"></p>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary w-100" onclick="handleLogin()">Access Portal</button>
                </div>
            </div>
        </div>
    </div>

    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // ================= CONFIGURATION =================
        let currentRole = null;

        // ================= VIEW LOGIC =================
        
        // 1. Select Role (User clicks Card)
        function selectRole(role) {
            currentRole = role;
            const modal = new bootstrap.Modal(document.getElementById('authModal'));
            
            // Reset inputs
            document.getElementById('admin-inputs').classList.add('d-none');
            document.getElementById('citizen-inputs').classList.add('d-none');

            // Show appropriate inputs based on role
            if(role === 'admin') {
                document.getElementById('modalTitle').innerText = "Admin Authorization";
                document.getElementById('admin-inputs').classList.remove('d-none');
            } else {
                document.getElementById('modalTitle').innerText = "Citizen Verification";
                document.getElementById('citizen-inputs').classList.remove('d-none');
            }
            modal.show();
        }

        // 2. Handle Login / Navigation
        // 2. Handle Login / Navigation
        function handleLogin() {
            // Close Modal
            const modalEl = document.getElementById('authModal');
            const modal = bootstrap.Modal.getInstance(modalEl);
            modal.hide();

            if(currentRole === 'admin') {
                // >>> CHANGE THIS LINE <<<
                // Old: window.location.href = 'admin.html';
                
                // New: Point to the new folder
                console.log("Redirecting to Admin Portal...");
                window.location.href = 'admin/index.html'; 
            } else {
                // Citizen Logic
                alert("Location Verified. Loading Citizen Portal...");
                window.location.href = 'citizen.html';
            }
        }

        // Helper: Mock Geo-Location for Citizen
        // Helper: Real Geo-Location for Verification
        function getGeoLocation() {
            const statusText = document.getElementById('location-status');
            statusText.innerText = "üõ∞Ô∏è Connecting to Satellites...";
            statusText.className = "mt-2 small text-warning";

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        // Success
                        const lat = position.coords.latitude.toFixed(4);
                        const lng = position.coords.longitude.toFixed(4);
                        
                        statusText.innerHTML = `‚úÖ <strong>Verified:</strong> ${lat}, ${lng}`;
                        statusText.className = "mt-2 small text-success";
                        
                        // Optional: Save to localStorage to use later
                        localStorage.setItem('user_lat', lat);
                        localStorage.setItem('user_lng', lng);
                    },
                    (error) => {
                        // Error
                        statusText.innerText = "‚ùå GPS Denied. Please enable location.";
                        statusText.className = "mt-2 small text-danger";
                    }
                );
            } else {
                statusText.innerText = "‚ùå Browser does not support Geolocation.";
            }
        }
    </script>
</body>
</html>